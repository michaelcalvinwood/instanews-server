<article><p>My site is an opportunity to try new tech and form opinions on what I enjoy using. I learn best by building real things. After some evaluation, I've landed on the following tech stack:</p>
<ul>
<li>Next.js (Upgraded to <code>v10</code>)</li>
<li>Tailwind CSS (Switched from Chakra UI)</li>
<li><code>next-mdx-remote</code> (Switched from <code>next-mdx-enhanced</code>)</li>
<li>Deployed with Vercel</li>
</ul>
<p>I've improved performance, added new features, and cleaned up some code. Let's dive into why I chose this tech stack.</p>
<h3 id="nextjs-10"><a target="_blank" href="https://leerob.io/blog/tailwind#nextjs-10"><span></span></a>Next.js 10</h3>
<p>Next.js 10 introduced the <a target="_blank" href="https://nextjs.org/docs/basic-features/image-optimization">Image Component and Automatic Image Optimization</a>. I've optimized images manually before (using ImageAlpha / ImageOptim) as well as with automated tools (like ImgBot). With Next.js 10, I no longer need to worry about that.</p>
<p>The <code>Image</code> component helps prevent <a target="_blank" href="https://web.dev/cls/">Cumulative Layout Shift</a> (CLS) by defining the <code>width</code> and <code>height</code> ahead of time. No more jumping layouts. It only loads images as they're scrolled into the viewport, keeping page loads fast. Plus, images are served in modern formats like <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types">WebP</a> when the browser supports it.</p>
<p>Preventing CLS required a mental model shift. Previously, my images used normal Markdown image syntax and expanded to fill the width of their container (<code>700px</code>). For example:</p>
<p>I wanted to avoid using the <code>height</code> and <code>width</code> props of <code>next/image</code>, if possible. The <code>Image</code> component exposes different <a target="_blank" href="https://nextjs.org/docs/api-reference/next/image#layout">layout props</a> like <code>layout=fill</code>, which led to me believe I could <a target="_blank" href="https://github.com/vercel/next.js/blob/canary/examples/image-component/pages/layout-fill.js">escape defining sizes</a>. In reality, there's no way to avoid layout shift unless you explicitly tell the layout how much space to allocate. Once that clicked in my head, the <code>Image</code> component made sense.</p>
<p>This meant switching from Markdown image syntax (shown above) to using <code>next/image</code> via MDX. Since I had hundreds of Markdown files, I wanted to automate this. I created a <a target="_blank" href="https://github.com/leerob/leerob.io/blob/fb9c02b76128d91717a226e5c118b5c56e11696e/scripts/markdown-to-next-image.js">Node script using remark</a> that transformed every image and read the dimensions from the file system. For example, the above Markdown image was transformed to:</p>
<div><pre><code><span><span>&lt;</span><span>Image</span><span> </span><span>alt</span><span>=</span><span>"Siamese Cat"</span><span> </span><span>src</span><span>=</span><span>"/cat.png"</span><span> </span><span>height</span><span>=</span><span>{</span><span>50</span><span>}</span><span> </span><span>width</span><span>=</span><span>{</span><span>50</span><span>}</span><span> /&gt;</span></span></code></pre></div>
<h3 id="tailwind-css"><a target="_blank" href="https://leerob.io/blog/tailwind#tailwind-css"><span></span></a>Tailwind CSS</h3>
<p>At first glance, Tailwind seems horrible. I've heard this sentiment many times and read <a target="_blank" href="https://adamwathan.me/css-utility-classes-and-separation-of-concerns/">Adam's rebuttals</a>. Earlier this year, I had the opportunity to try Tailwind on a project. I didn't hate it. Still, I needed a larger project to form an opinion on the framework.</p>
<p>Well, the verdict is out. <strong>I really enjoy Tailwind.</strong> There was a learning curve as I tried to translate my existing CSS knowledge to Tailwind specific naming. For example, this vanilla CSS:</p>
<div><pre><code><span><span>display: flex;</span></span>
<span><span>flex-direction</span><span>: row;</span></span>
<span><span>align-items</span><span>: center;</span></span></code></pre></div>
<p>translates to these utility classes with Tailwind:</p>
<div><pre><code><span><span>&lt;</span><span>div</span><span> </span><span>className</span><span>=</span><span>"flex flex-row items-center"</span><span> /&gt;</span></span></code></pre></div>
<p>The Tailwind classes feel intuitive and their documentation makes it easy. The underlying idea of being bound to a design system made plenty of sense coming from Chakra UI. For example:</p>
<div><pre><code><span><span>import</span><span> { </span><span>Flex</span><span> } </span><span>from</span><span> </span><span>'@chakra-ui/react'</span><span>;</span></span>
<span> </span>
<span><span>&lt;</span><span>Flex</span><span> </span><span>px</span><span>=</span><span>{</span><span>4</span><span>}</span><span> </span><span>py</span><span>=</span><span>{</span><span>2</span><span>}</span><span> /&gt;;</span></span></code></pre></div>
<p>Chakra's <a target="_blank" href="https://chakra-ui.com/docs/theming/theme#spacing">spacing system</a> is inspired by Tailwind. 1 spacing unit is equal to <code>0.25rem</code>, which translates to <code>4px</code> by default in most browsers. In the example below, we're adding <code>16px</code> of horizontal padding and <code>8px</code> of vertical padding.</p>
<div><pre><code><span><span>&lt;</span><span>div</span><span> </span><span>className</span><span>=</span><span>"px-4 py-2"</span><span> /&gt;</span></span></code></pre></div>
<p>I still enjoy Chakra for larger applications. Having pre-built UI components saves a lot of time. Their documentation has some good notes on the <a target="_blank" href="https://chakra-ui.com/docs/comparison#how-is-chakra-different-from-tailwind-css">differences between Tailwind</a>. For further reading, check out <a target="_blank" href="https://leerob.io/blog/css-with-react">How Should I Style My React Application?</a>.</p>
<h3 id="dark-mode"><a target="_blank" href="https://leerob.io/blog/tailwind#dark-mode"><span></span></a>Dark Mode</h3>
<p>Tailwind 2.0 makes using dark mode painless. Enable the <code>dark</code> <a target="_blank" href="https://tailwindcss.com/docs/dark-mode">variant</a> and prefix your classes with <code>dark:</code>. That's pretty much it.</p>
<div><pre><code><span><span>&lt;</span><span>div</span><span> </span><span>class</span><span>=</span><span>"bg-white dark:bg-gray-800"</span><span> /&gt;</span></span></code></pre></div>
<p>I was able to keep a <a target="_blank" href="https://github.com/leerob/leerob.io/blob/91233631f0e1a193295ffc54d2291f3109060007/components/Container.tsx">dark mode toggle</a> in the navigation thanks to <a target="_blank" href="https://github.com/pacocoursey/next-themes">next-themes</a>. Tailwind and <code>next-themes</code> <a target="_blank" href="https://github.com/pacocoursey/next-themes#with-tailwind">pair well</a> together.</p>
<div><pre><code><span><span>import</span><span> { </span><span>useTheme</span><span> } </span><span>from</span><span> </span><span>'next-themes'</span><span>;</span></span>
<span> </span>
<span><span>const</span><span> </span><span>ThemeChanger</span><span> </span><span>=</span><span> () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>const</span><span> { </span><span>theme</span><span>, </span><span>setTheme</span><span> } </span><span>=</span><span> </span><span>useTheme</span><span>();</span></span>
<span> </span>
<span><span>  </span><span>return</span><span> (</span></span>
<span><span>    &lt;</span><span>div</span><span>&gt;</span></span>
<span><span>      The current theme is: </span><span>{</span><span>theme</span><span>}</span></span>
<span><span>      &lt;</span><span>button</span><span> </span><span>onClick</span><span>=</span><span>{</span><span>() </span><span>=&gt;</span><span> </span><span>setTheme</span><span>(</span><span>'light'</span><span>)</span><span>}</span><span>&gt;Light Mode&lt;/</span><span>button</span><span>&gt;</span></span>
<span><span>      &lt;</span><span>button</span><span> </span><span>onClick</span><span>=</span><span>{</span><span>() </span><span>=&gt;</span><span> </span><span>setTheme</span><span>(</span><span>'dark'</span><span>)</span><span>}</span><span>&gt;Dark Mode&lt;/</span><span>button</span><span>&gt;</span></span>
<span><span>    &lt;/</span><span>div</span><span>&gt;</span></span>
<span><span>  );</span></span>
<span><span>};</span></span></code></pre></div>
<p>I hit a few issues along the way adding dark mode to Tailwind Typography. The documentation felt a bit disjointed from the rest of Tailwind. I would have expected more guidance on pairing the two together.</p>
<p>After digging through GitHub Issues, I was able to <a target="_blank" href="https://github.com/leerob/leerob.io/blob/91233631f0e1a193295ffc54d2291f3109060007/tailwind.config.js">get things working</a>. It wasn't obvious I needed <code>dark:prose-dark</code>. I also managed to get <a target="_blank" href="https://github.com/leerob/leerob.io/blob/91233631f0e1a193295ffc54d2291f3109060007/styles/global.css">syntax highlighting</a> working through some custom styles.</p>
<h2 id="performance"><a target="_blank" href="https://leerob.io/blog/tailwind#performance"><span></span></a>Performance</h2>
<p>Libraries like <code>emotion</code> and <code>styled-system</code> require runtime JavaScript to compute styles and generate class names. That doesn't mean you can't use <a target="_blank" href="https://github.com/callstack/linaria">CSS-in-JS</a> <a target="_blank" href="https://github.com/ben-rogerson/twin.macro">correctly</a>. But I'd argue using "plain" CSS helps you fall into the <a target="_blank" href="https://blog.codinghorror.com/falling-into-the-pit-of-success/">pit of success</a> (<a target="_blank" href="https://nextjs.org/docs/basic-features/built-in-css-support">CSS Modules</a>, Tailwind, etc) more easily.</p>
<p>There is no correct answer. Each has their own tradeoffs. For my simple site, I choose the performance tradeoff. I was able to reduce the <a target="_blank" href="https://nextjs.org/docs/api-reference/cli#build">number of assets downloaded</a> <strong>by 43%</strong>.</p>
<ul>
<li>📦 Before → <code>~150kb</code> First Load JS</li>
<li>📈 After → <code>~85kb</code> First Load JS</li>
</ul>
<p>This change, paired with <code>next/image</code>, has my <a target="_blank" href="https://vercel.com/docs/analytics">Vercel Analytics</a> looking incredible. Zero CLS.</p>
<img alt="Vercel Analytics" srcset="https://leerob.io/_next/image?url=%2Fimages%2Ftailwind%2Fanalytics.jpg&amp;w=1080&amp;q=75 1x, https://leerob.io/_next/image?url=%2Fimages%2Ftailwind%2Fanalytics.jpg&amp;w=2048&amp;q=75 2x" src="https://leerob.io/_next/image?url=%2Fimages%2Ftailwind%2Fanalytics.jpg&amp;w=2048&amp;q=75" />
<h3 id="mdx"><a target="_blank" href="https://leerob.io/blog/tailwind#mdx"><span></span></a>MDX</h3>
<p><a target="_blank" href="https://leerob.io/blog/mdx">Last year</a>, I switched from using <code>@next/mdx</code> to <code>next-mdx-enhanced</code> mostly for front matter and layout support. These are now both <a target="_blank" href="https://nextjs.org/blog/markdown">solved problems</a>. Given that <a target="_blank" href="https://github.com/hashicorp/next-mdx-enhanced">next-mdx-enhanced</a> will likely be deprecated soon (see below) I wanted to explore <a target="_blank" href="https://github.com/hashicorp/next-mdx-remote">next-mdx-remote</a>.</p>
<blockquote>
<p>You probably should be using <code>next-mdx-remote</code> instead of this library. It is ~50% faster, more flexible with content storage, does not induce memory issues at scale, and fits much better with the way that data is intended to flow through Next.js.</p>
</blockquote>
<p>With the addition of <code>getStaticPaths</code> / <code>getServerSideProps</code>, you can treat your MDX data like any other data source in Next.js. It also removes the limitation of being bound to <a target="_blank" href="https://nextjs.org/docs/basic-features/pages">file-system based routing</a> for your <code>.mdx</code> files. Since my site has hundreds of MDX files, moving these to a top-level <code>data/</code> folder made more sense to me.</p>
<p>Still, the MDX experience feels <em>fragmented</em>. I'd like to merge <code>next-mdx-remote</code> with <code>@next/mdx</code> so there are fewer options. <a target="_blank" href="https://github.com/shuding/nextra">nextra</a> (another related project) allows you to use methods like <code>getStaticProps</code> directly inside your MDX files. Maybe there's a path to convergence for all three.</p>
<h3 id="other"><a target="_blank" href="https://leerob.io/blog/tailwind#other"><span></span></a>Other</h3>
<p>I added <a target="_blank" href="https://nextjs.org/docs/advanced-features/module-path-aliases">absolute Imports and module path aliases</a> to improve the readability of nested imports inside files. Here's a before and after example:</p>
<div><pre><code><span><span>// Before</span></span>
<span><span>import</span><span> </span><span>db</span><span> </span><span>from</span><span> </span><span>'../../lib/db-admin'</span><span>;</span></span>
<span> </span>
<span><span>// After</span></span>
<span><span>import</span><span> </span><span>db</span><span> </span><span>from</span><span> </span><span>'lib/db-admin'</span><span>;</span></span></code></pre></div></article>